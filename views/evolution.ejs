<% include header %>

  <div style="margin-top: 3% !important;"></div>
  <div class="ui grid">
    <div class="ui container">
      <% if  (evolutionReport != null){ %>

        <h1> Evolution Report</h1>
        <p>
          You can move and zoom the timeline, and select items.</p>
        <% } %>

          <div id="visualization"></div>
          <div style="padding-top:50px; padding-bottom:50px">
                <%if (history === null) {%>
            <table id="commitsTable" class="display" cellspacing="0" width="100%">
              <thead>
                <tr>
                  <th>Pusher</th>
                  <th>Commit Message</th>
                  <th>Timestamp</th>
                  <th>Changes</th>

                </tr>
              </thead>
              <tfoot>
                <tr>
                  <th>Pusher</th>
                  <th>Commit Message</th>
                  <th>Timestamp</th>
                  <th>Changes</th>
                </tr>
              </tfoot>
              <tbody>
                <%if (history != null) {%>
                <% for(var i = 0; i < history.length; i++){%>
                  <tr>
                    <td> <%= history[i].pusher %></td>
                    <td><%= history[i].commitMessage %></td>
                    <td><%= history[i].start %></td>
                      <td><a href="#visualization" onmousedown="show(&quot;<%= history[i].start %>&quot;); return false;">Show</td>
                  </tr>
                <%}%>
                <%}%>
              </tbody>
            </table>
                <%}%>
          </div>
          <div id='commitDetails'>
          </div>
    </div>

    <% include footer %>

      <script type="text/javascript">

      function show(timeStamp)
      {
        var commitData = <%- JSON.stringify(evolutionReport) %>;
        var historyData = <%- JSON.stringify(history) %>;
        var commitObject = historyData.filter(function(o){
          return o.start === timeStamp;
        })
        $("#commitDetails").html("");
        $("#commitDetails").append("<div><h4>User: &quot;" + commitObject[0].pusher + "&quot; - Commit Message: &quot;" + commitObject[0].commitMessage + '&quot; - Timestamp: &quot;' + timeStamp + "&quot;</h4>");
          commitData.forEach(function(element) {
            if (element.commitTimestamp === timeStamp) {
              if (element.event === 'add')
                $("#commitDetails").append("<h6><p class='bg-success text-default' style='margin-right:250px;'> + " + element.value + "</p></h6>");
            }
          })
          commitData.forEach(function(element) {
            if (element.commitTimestamp === timeStamp) {
              if (element.event === 'del')
                $("#commitDetails").append("<h6><p class='bg-danger text-default' style='margin-right:250px;'>  - " + element.value + "</p></h6>");

            }
          })
          $("#commitDetails").append("</div>");
      }
        if (!<%- JSON.stringify(history) %>) {

          // DOM element where the Timeline will be attached
          var container = document.getElementById('visualization');
          // Create a DataSet (allows two way data-binding)
          var items = new vis.DataSet();
          // show timeLine with empty dataset
          $(function() {
            $(".vis-timeline").css("visibility", "visible");
          });
          // Configuration for the Timeline
          var options = {
            'width': '100%',
            'height': '300px'
          };
          // Create a Timeline
          var timeline = new vis.Timeline(container, items, options);

        } else {
          $(document).ready(function() {
            $('#commitsTable').DataTable();
          });
          // DOM element where the Timeline will be attached
          var container = document.getElementById('visualization');
          // Create a DataSet (allows two way data-binding)
          var items = new vis.DataSet(<%- JSON.stringify(history) %>);
          // Configuration for the Timeline
          var options = {
            'width': '100%',
            'height': '300px'
          };

          // Create a Timeline
          var timeline = new vis.Timeline(container, items, options);
          timeline.on('select', function(properties) {
            $(location).attr('href', items._data[properties.items[0]].link)
          });
        }
      </script>
