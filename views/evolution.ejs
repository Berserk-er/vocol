<% include header %>
<<<<<<< HEAD

=======
>>>>>>> 605efe411cacf5f9bb425972e5d2842e34597d46
  <div style="margin-top: 3% !important;"></div>
  <div class="ui grid">
    <div class="ui container">
      <% if  (evolutionReport != null){ %>

<<<<<<< HEAD
        <h1> Evolution Report</h1>
=======
        <h2> Evolution Report</h2>
>>>>>>> 605efe411cacf5f9bb425972e5d2842e34597d46
        <p>
          You can move and zoom the timeline, and select items.</p>
        <% } %>

<<<<<<< HEAD
          <div id="visualization"></div>
          <%if (history !="") {%>
            <div class="ui vertical labeled icon buttons" style="padding-top:40px; ">
              <div class="ui button">
                <i class="shuffle icon"></i> Reset Table Data
              </div>
            </div>
            <div style="padding-top:10px; padding-bottom:50px">
              <table id="commitsTable" class="display" cellspacing="0" width="100%">
                <thead>
                  <tr>
                    <th>Pusher</th>
                    <th>Commit Message</th>
                    <th>Timestamp</th>
                    <th>Change Type</th>
                    <th>Change Triple</th>
                  </tr>
                </thead>
                <tfoot>
                  <tr>
                    <th>Pusher</th>
                    <th>Commit Message</th>
                    <th>Timestamp</th>
                    <th>Change Type</th>
                    <th>Changes Triple</th>
                  </tr>
                </tfoot>
                <tbody id="tableData">
                  <%}%>
                </tbody>
              </table>
            </div>
            <div id='commitDetails'>
            </div>
    </div>
    <% include footer %>
      <script type="text/javascript">
      var commitData = "" ;
        if (!<%- JSON.stringify(history) %>) {
=======
          <div id="visualization">
          </div>
          <div id='commitDetails'>
          </div>
    </div>

    <% include footer %>

      <script type="text/javascript">
        if (!<%- JSON.stringify(history) %>) {

          // DOM element where the Timeline will be attached
>>>>>>> 605efe411cacf5f9bb425972e5d2842e34597d46
          var container = document.getElementById('visualization');
          // Create a DataSet (allows two way data-binding)
          var items = new vis.DataSet();
          // show timeLine with empty dataset
          $(function() {
            $(".vis-timeline").css("visibility", "visible");
          });
          // Configuration for the Timeline
          var options = {
            'width': '100%',
            'height': '300px'
          };
          // Create a Timeline
          var timeline = new vis.Timeline(container, items, options);

        } else {
<<<<<<< HEAD
          commitData = <%- JSON.stringify( evolutionReport)%>;
          var isNodeSelected = false;
          //$('#commitsTable').DataTable();
          $(document).ready(function() {
            if (!isNodeSelected) {
              $('#commitsTable').DataTable({
                data: filterTableData(commitData)
              });
            }
          });
=======
>>>>>>> 605efe411cacf5f9bb425972e5d2842e34597d46
          // DOM element where the Timeline will be attached
          var container = document.getElementById('visualization');
          // Create a DataSet (allows two way data-binding)
          var items = new vis.DataSet(<%- JSON.stringify(history) %>);
          // Configuration for the Timeline
          var options = {
            'width': '100%',
            'height': '300px'
          };

<<<<<<< HEAD
=======

>>>>>>> 605efe411cacf5f9bb425972e5d2842e34597d46
          // Create a Timeline
          var timeline = new vis.Timeline(container, items, options);
          timeline.on('select', function(properties) {
            $(location).attr('href', items._data[properties.items[0]].link)
<<<<<<< HEAD
            isNodeSelected = true;
            $('#commitsTable').dataTable().fnClearTable();
            $('#commitsTable').dataTable().fnAddData(filterTableData(commitData, items._data[properties.items[0]].link));
          });
        }
        $('.ui.button').click(function(){
          $('#commitsTable').dataTable().fnClearTable();
          $('#commitsTable').dataTable().fnAddData(filterTableData(commitData));
        })

        function filterTableData(data, str) {
          var tableBody = "";
          var dataTable = data;
          var array = [];
          if (str)
            dataTable = data.filter(function(o) {
              return o.commitTimestamp === str.split("#")[1];
            })
          for (var i = 0; i < dataTable.length; i++) {
            var arr = [];
            arr.push(dataTable[i].pusher, dataTable[i].commitMessage, dataTable[i].commitTimestamp, dataTable[i].event, dataTable[i].value)
            array.push(arr);
          }
          return array;
=======
          });


          var commitData = <%- JSON.stringify(evolutionReport) %>;

          console.log(commitData);
          var versionsJSONArray = _.uniqBy(commitData, v => [v.commitTimestamp].join());

          console.log(versionsJSONArray);
          versionsJSONArray.forEach(function(item) {
            $("#commitDetails").append("<br /><div  id=" + item.commitTimestamp + "><h4>User: &quot;" + item.pusher + "&quot; - Commit Message: &quot;" + item.commitMessage + '&quot; - Timestamp: &quot;' + item.commitTimestamp + "&quot;</h4>");
            commitData.forEach(function(element) {
              if (element.commitTimestamp === item.commitTimestamp) {
                if (element.event === 'add')
                  $("#commitDetails").append("<h6><p class='bg-success text-default' style='margin-right:440px;'> + " + element.value + "</p></h6>");
                // else if (element.event === 'del')
                //   $("#commitDetails").append("<h6><p class='bg-danger text-danger' style='margin-right:390px;'>  - " + element.value + "</p></h6>");

              }
            })
            commitData.forEach(function(element) {
              if (element.commitTimestamp === item.commitTimestamp) {
                if (element.event === 'del')
                  $("#commitDetails").append("<h6><p class='bg-danger text-default' style='margin-right:440px;'>  - " + element.value + "</p></h6>");

              }
            })
            $("#commitDetails").append("</div>");

          });
>>>>>>> 605efe411cacf5f9bb425972e5d2842e34597d46
        }
      </script>
