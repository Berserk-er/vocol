<% include header %>

  <div style="margin-top: 3% !important;"></div>
  <div class="ui grid">
    <div class="ui container">
      <% if  (evolutionReport != null){ %>

        <h1> Evolution Report</h1>
        <p>
          You can move and zoom the timeline, and select items.</p>
        <% } %>

          <div id="visualization"></div>
<<<<<<< HEAD
          <%if (history !="") {%>
            <div class="ui vertical labeled icon buttons" style="padding-top:40px; ">
              <div class="ui button">
                <i class="shuffle icon"></i> Reset Table Data
              </div>
            </div>
            <div style="padding-top:10px; padding-bottom:50px">
              <table id="commitsTable" class="display" cellspacing="0" width="100%">
                <thead>
                  <tr>
                    <th>Pusher</th>
                    <th>Commit Message</th>
                    <th>Timestamp</th>
                    <th>Change Type</th>
                    <th>Change Triple</th>
                  </tr>
                </thead>
                <tfoot>
                  <tr>
                    <th>Pusher</th>
                    <th>Commit Message</th>
                    <th>Timestamp</th>
                    <th>Change Type</th>
                    <th>Changes Triple</th>
                  </tr>
                </tfoot>
                <tbody id="tableData">
                  <%}%>
                </tbody>
              </table>
            </div>
            <div id='commitDetails'>
            </div>
=======
          <div style="padding-top:50px; padding-bottom:50px">
                <%if (history === null) {%>
            <table id="commitsTable" class="display" cellspacing="0" width="100%">
              <thead>
                <tr>
                  <th>Pusher</th>
                  <th>Commit Message</th>
                  <th>Timestamp</th>
                  <th>Changes</th>

                </tr>
              </thead>
              <tfoot>
                <tr>
                  <th>Pusher</th>
                  <th>Commit Message</th>
                  <th>Timestamp</th>
                  <th>Changes</th>
                </tr>
              </tfoot>
              <tbody>
                <%if (history != null) {%>
                <% for(var i = 0; i < history.length; i++){%>
                  <tr>
                    <td> <%= history[i].pusher %></td>
                    <td><%= history[i].commitMessage %></td>
                    <td><%= history[i].start %></td>
                      <td><a href="#visualization" onmousedown="show(&quot;<%= history[i].start %>&quot;); return false;">Show</td>
                  </tr>
                <%}%>
                <%}%>
              </tbody>
            </table>
                <%}%>
          </div>
          <div id='commitDetails'>
          </div>
>>>>>>> 669975f435f4c5e7188383c536ff19793dc3badb
    </div>
    <% include footer %>
      <script type="text/javascript">
<<<<<<< HEAD
      var commitData = "" ;
=======

      function show(timeStamp)
      {
        var commitData = <%- JSON.stringify(evolutionReport) %>;
        var historyData = <%- JSON.stringify(history) %>;
        var commitObject = historyData.filter(function(o){
          return o.start === timeStamp;
        })
        $("#commitDetails").html("");
        $("#commitDetails").append("<div><h4>User: &quot;" + commitObject[0].pusher + "&quot; - Commit Message: &quot;" + commitObject[0].commitMessage + '&quot; - Timestamp: &quot;' + timeStamp + "&quot;</h4>");
          commitData.forEach(function(element) {
            if (element.commitTimestamp === timeStamp) {
              if (element.event === 'add')
                $("#commitDetails").append("<h6><p class='bg-success text-default' style='margin-right:250px;'> + " + element.value + "</p></h6>");
            }
          })
          commitData.forEach(function(element) {
            if (element.commitTimestamp === timeStamp) {
              if (element.event === 'del')
                $("#commitDetails").append("<h6><p class='bg-danger text-default' style='margin-right:250px;'>  - " + element.value + "</p></h6>");

            }
          })
          $("#commitDetails").append("</div>");
      }
>>>>>>> 669975f435f4c5e7188383c536ff19793dc3badb
        if (!<%- JSON.stringify(history) %>) {
          var container = document.getElementById('visualization');
          // Create a DataSet (allows two way data-binding)
          var items = new vis.DataSet();
          // show timeLine with empty dataset
          $(function() {
            $(".vis-timeline").css("visibility", "visible");
          });
          // Configuration for the Timeline
          var options = {
            'width': '100%',
            'height': '300px'
          };
          // Create a Timeline
          var timeline = new vis.Timeline(container, items, options);

        } else {
<<<<<<< HEAD
          commitData = <%- JSON.stringify( evolutionReport)%>;
          var isNodeSelected = false;
          //$('#commitsTable').DataTable();
          $(document).ready(function() {
            if (!isNodeSelected) {
              $('#commitsTable').DataTable({
                data: filterTableData(commitData)
              });
            }
=======
          $(document).ready(function() {
            $('#commitsTable').DataTable();
>>>>>>> 669975f435f4c5e7188383c536ff19793dc3badb
          });
          // DOM element where the Timeline will be attached
          var container = document.getElementById('visualization');
          // Create a DataSet (allows two way data-binding)
          var items = new vis.DataSet(<%- JSON.stringify(history) %>);
          // Configuration for the Timeline
          var options = {
            'width': '100%',
            'height': '300px'
          };

          // Create a Timeline
          var timeline = new vis.Timeline(container, items, options);
          timeline.on('select', function(properties) {
            $(location).attr('href', items._data[properties.items[0]].link)
            isNodeSelected = true;
            $('#commitsTable').dataTable().fnClearTable();
            $('#commitsTable').dataTable().fnAddData(filterTableData(commitData, items._data[properties.items[0]].link));
          });
<<<<<<< HEAD
        }
        $('.ui.button').click(function(){
          $('#commitsTable').dataTable().fnClearTable();
          $('#commitsTable').dataTable().fnAddData(filterTableData(commitData));
        })

        function filterTableData(data, str) {
          var tableBody = "";
          var dataTable = data;
          var array = [];
          if (str)
            dataTable = data.filter(function(o) {
              return o.commitTimestamp === str.split("#")[1];
            })
          for (var i = 0; i < dataTable.length; i++) {
            var arr = [];
            arr.push(dataTable[i].pusher, dataTable[i].commitMessage, dataTable[i].commitTimestamp, dataTable[i].event, dataTable[i].value)
            array.push(arr);
          }
          return array;
=======
>>>>>>> 669975f435f4c5e7188383c536ff19793dc3badb
        }
      </script>
